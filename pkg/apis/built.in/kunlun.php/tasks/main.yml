---
- import_role:
    name: nginxinc.nginx
  become: true
  become_user: root
- import_role:
    name: geerlingguy.php
  become: true
  become_user: root
- import_role:
    name: geerlingguy.git
  become: true
  become_user: root
- import_role:
    name: geerlingguy.composer
  become: true
  become_user: root
- import_role:
    name: geerlingguy.php-mysql
  become: true
  become_user: root

# run the composer
- name: Install packages (composer)
  shell: composer install
  args:
    chdir: "{{ project_src_root }}"

# setup the nginx config.
- name: Update nginx config
  template:
    src: nginx.j2
    dest: "{{ nginx_config_root }}/conf.d/{{ kl_site_name }}.conf"
    owner: "{{ ansible_user }}"
    mode: 0644
  become: true
  become_user: root